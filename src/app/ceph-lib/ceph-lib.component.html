<div id="card-canvas" class="card-body">
  <div class="zoomButtonGroups">
    <button class="zoomIn btn btn-outline-primary" (click)="zoomIn()"> + </button>
    <button class="zoomOut btn btn-outline-primary" (click)="zoomOut()"> - </button>
    <button class="reset btn btn-outline-primary" (click)="reset()"> Reset </button>
  </div>

  <!-- <div class = "containmentDiv1" >
    </div> -->
  <div class = "containmentDiv">
  <div class="stack-canvas" id="divBG" [ngStyle]="{'width': '899px',
    'height': '750px',
    'position' : 'absolute',
    'cursor' : 'crosshair',
    'border': '2px solid ',
    'margin-left': '46%',
    'margin-top': '86px'
  }">
  <div class="overlay" (contextmenu) = "disableContextMenu()" (click) = "addPoint($event)" [ngStyle]=  "{'cursor':'crosshair'}" id = "image-container">
  <img src = "{{imageURL}}" width = "899" height = "800" id = "image" [ngStyle] = "{'filter' : 'contrast('+contrastSetting+'%) brightness('+brightnessSetting+'%) invert('+invertSetting+'%)'}"/>
        <ng-container *ngFor="let points of pointsArray | keyvalue">
          
          <span draggable="true"
            [ngStyle]="{'display':'block','position':'absolute', 'width':'7px', 'height':'7px','background-color':'white','border-radius':'30px','top': points.value.y +'px', 'left': points.value.x +'px','z-index':900, 'pointer-events' : 'none'}">
          </span>
        
        <span [ngStyle]="{'display':'block','position':'absolute', 'font-size' : '20px','color': 'white','top': points.value.y + 10  +'px', 'left': points.value.x + 10 +'px','z-index':900, 'pointer-events': 'none'}">{{points.value.point_name_alias}}</span>

        </ng-container> 
        <svg height="800" width="899" style = "position:relative">
        <ng-container *ngFor="let line of lineArr">
          <ng-container *ngIf = "line.id == 'C1-C2'">
            <line [attr.x1]="line.x1 + 3" [attr.y1]="line.y1 + 3" [attr.x2]="line.x2 + 3" [attr.y2]="line.y2 + 3" style="stroke:rgb(254, 254, 254);"[attr.stroke-dasharray] = '2' />
          </ng-container>
        </ng-container>
        </svg> 
        <ng-container *ngFor="let line of lineArr">
        <ng-container *ngIf = "line.id != 'C1-C2'">
          <ng-container *ngIf = "line.id == 'ANS-N' || line.id == 'ANS-Me'">
            <span [ngStyle] = "{'position':'relative', 'color' : 'black' ,'font-size': '15px', 'top': line.top +'px', 'left' : line.left + 'px', 'z-index' : 900, 'pointer-events' : 'none'}">{{line.distanceinmm}}mm</span>
          </ng-container>
          <span [ngStyle] = "{'display':'block','padding': '0px','margin': '0px','height': '2px','border-bottom':'1px dashed rgb(227, 227, 227)','line-height': '1px','position': 'absolute','left': line.x.x_left +'px','top': line.x.x_top +'px','width': line.x.x_distance +'px','transform': 'rotate('+line.x.x_angle+'deg)', 'z-index' : 900, 'pointer-events' : 'none'}"></span>
          </ng-container>
        </ng-container>
      </div>
    </div>
    </div>
    <div class="right-menu-main">
      <div class = "magnificationFactorInput" style = "z-index:100">
      Enter the Magnification Factor in mm
      <form [formGroup] = "calibrationMagnification">
        <input type = "text" formControlName="magnificationFactor"/>
      </form>
      </div>
      <div class="right-menu-images">
        <div class="buttonGroups">
          <button class = "btn btn-outline-success" (click) = "submitPayload()"><mat-icon class = "align-middle">save</mat-icon><span class = "align-middle">Save</span></button>
          <button class = "btn btn-outline-primary" (click) = "goBackToMainPage()"><mat-icon class = "align-middle">cancel</mat-icon>  <span class = "align-middle">Cancel</span></button>
          <button class = "btn btn-outline-success" (click) = "exportToJPEG()"><mat-icon class = "align-middle">cloud_download</mat-icon> <span class = "align-middle"> Export as JPEG </span></button>
          <button class = "btn btn-outline-success" (click) = "exportToPDF()"><mat-icon class = "align-middle">cloud_download</mat-icon> <span class = "align-middle"> Export as PDF </span></button>
          <button class = "btn btn-outline-success" (click) = "showImageSettings()"> <mat-icon class = "align-middle">settings</mat-icon> <span class = "align-middle"> Image settings </span></button>
          <button class = "btn btn-outline-primary" (click) = "resetAllPoints()"> <mat-icon class = "align-middle"> loop </mat-icon> <span class = "align-middle">Reset</span></button>
        </div>
        
        <ng-container *ngIf="previewImage">
          <img src="{{previewImage}}" style="position:relative; z-index:100" width=272 height=304>
        </ng-container>
      </div>
      <p-dialog [(visible)]="showImageSettingsPanel" [modal]="false" 
      [draggable]="true" [resizable]="true" >
      <p-header>
        Image Settings 
        <input type = "button" class = "btn btn-outline-primary" (click) = "resetAllSettings()" value = "Reset"/> 
        </p-header>

        <form [formGroup] = "imageSettings">
        Adjust Contrast <input type = "range" formControlName = "contrastSlider" max="200" min="0" (change) = "changeImageSettings('Contrast',$event)"/>
        Adjust Brightness <input type="range" formControlName = "brightnessSlider" max = "200" min = "0" (change) = "changeImageSettings('Brightness',$event)"/>
        Adjust Invert <input type = "range" formControlName = "invertSlider" max = "100" min = "0" (change) = "changeImageSettings('Invert', $event)"/>
        </form>

        
      </p-dialog>
      <div class="pointsDiv">
        <select class="selectOptions" style="position: relative;" (change) = "analysisChange($event)">
          <option selected value="steinerAnalysis"> Steiner Analysis </option>
        </select>
        
      </div>
   
<div class="card-body right-menu">
  <div style = "position: sticky;
  background-color: rgb(236, 236, 236);
  /* width: 51.5%; */
  top: 0;
  width: 100%;
">
    <h4 style = "position: relative;
    font-weight: bold;
    color: #000000;
    top: 45px;
    left: 20px;"> Points </h4> <span style = "margin-left: 158px"> All Points marked  <ng-container *ngIf = "allPointsCompleted else cond5"><b><mat-icon>check_circle_outline</mat-icon></b> </ng-container> <ng-template #cond5> <b><mat-icon>highlight_off</mat-icon></b> </ng-template></span>
    </div>
    <table class = "menu-title" style = "margin-top: 50px; border-collapse: separate;
    border-spacing: 0 15px;">

      <tr *ngFor="let option of options let i = index">
          <ng-container *ngIf="option.isActive else cond2">
              <td (click) = "selectedIndex(i)"><input type="checkbox" /><a class="link-btns">{{
                  option.pointName
                }}</a></td>
            </ng-container>
            
            <ng-template #cond2>
                <td><input type="checkbox" checked disabled /><a class="link-btns-disabled">{{
                    option.pointName
                  }} </a> </td>
                  <td> </td>
                  <td> </td>
                  <td><mat-icon (click)="removePoint(i)" style="font-size: 18px;float: right;">loop</mat-icon></td>
                  
                  </ng-template>
        </tr>
        
      </table>
</div>
   


    <div class="data-table">
      <table class="result-table">
        <tr>
          <th> Results </th>
          <th> Clinical Norm </th>
          <th> Value </th>
          <th> Interpretation </th>
        </tr>
        <ng-container *ngFor="let results of anglesArr">
          <ng-container *ngIf = "results.name != ''">
          <ng-container *ngIf = "results.id != 'C1-C2'">
            <ng-container *ngIf = "results.typeOfMeasurement == 'Angular' else cond5">
            <tr>
              <td>{{results.name}} </td>
              <td> {{results.mean}}° </td>
              <ng-container *ngIf = "results.value > results.mean else cond4">
                <td> <span style="color:red">{{results.value}}° </span> </td>
              </ng-container>
              <ng-template #cond4>
                <td> <span style = "color:green">{{results.value}}° </span> </td>
                </ng-template>
                <td> {{results.interpretation}} </td>
            </tr>
            </ng-container>

            <ng-template #cond5>
              <tr>
                  <td>{{results.name}} </td>
                  <td> {{results.mean}}mm </td>
                  <ng-container *ngIf = "results.value > results.mean else cond6">
                  <td> <span style="color:red">{{results.value}}mm</span> </td>
                  </ng-container>
                  <ng-template #cond6>
                    <td> <span style = "color:green">{{results.value}}mm </span> </td>
                  </ng-template>
                  <td> {{results.interpretation}} </td>
                 
              </tr>
              </ng-template>

        </ng-container>
        </ng-container>
        </ng-container>
        
    </table>
    </div>
</div> 


